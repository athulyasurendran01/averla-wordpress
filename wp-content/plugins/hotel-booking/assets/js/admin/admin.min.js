!function(t){t(function(){MPHB.BookingsCalendar=can.Control.extend({},{filtersForm:null,customPeriodWrapper:null,btnPeriodPrev:null,btnPeriodNext:null,periodEl:null,init:function(t,e){this.filtersForm=this.element.find("#mphb-bookings-calendar-filters"),this.customPeriodWrapper=this.filtersForm.find(".mphb-custom-period-wrapper"),this.btnPeriodPrev=this.filtersForm.find(".mphb-period-prev"),this.btnPeriodNext=this.filtersForm.find(".mphb-period-next"),this.periodEl=this.filtersForm.find("#mphb-bookings-calendar-filter-period"),this.searchDateFromEl=this.filtersForm.find(".mphb-search-date-from"),this.searchDateToEl=this.filtersForm.find(".mphb-search-date-to"),this.initDatepickers()},initDatepickers:function(){var t=this.filtersForm.find(".mphb-datepick");t.datepick({dateFormat:MPHB.Plugin.myThis.data.settings.dateFormat,showSpeed:0,showOtherMonths:!0})},"#mphb-bookings-calendar-filter-period change":function(e,i){var r=t(e).val();"custom"===r?(this.customPeriodWrapper.removeClass("mphb-hide"),this.btnPeriodNext.addClass("mphb-hide"),this.btnPeriodPrev.addClass("mphb-hide")):(this.customPeriodWrapper.addClass("mphb-hide"),this.btnPeriodNext.removeClass("mphb-hide"),this.btnPeriodPrev.removeClass("mphb-hide"))},"#mphb-booking-calendar-search-room-availability-status change":function(e,i){var r=t(e).val();""===r?(this.searchDateFromEl.addClass("mphb-hide"),this.searchDateToEl.addClass("mphb-hide")):(this.searchDateFromEl.removeClass("mphb-hide"),this.searchDateToEl.removeClass("mphb-hide"))}}),MPHB.Plugin=can.Construct.extend({myThis:null},{data:null,init:function(e,i){MPHB.Plugin.myThis=this,this.data=MPHB._data,delete MPHB._data;var r=t(".mphb-ctrl:not([data-inited])");this.setControls(r)},getVersion:function(){return this.data.version},getPrefix:function(){return this.data.prefix},addPrefix:function(t,e){return e="undefined"!=typeof e?e:"-",this.getPrefix()+e+t},setControls:function(e){var i,r;t.each(e,function(){switch(r=t(this).attr("data-type")){case"text":break;case"number":break;case"total-price":i=new MPHB.TotalPriceCtrl(t(this));break;case"gallery":i=new MPHB.GalleryCtrl(t(this));break;case"datepicker":i=new MPHB.DatePickerCtrl(t(this));break;case"color-picker":i=new MPHB.ColorPickerCtrl(t(this));break;case"complex":i=new MPHB.ComplexCtrl(t(this));break;case"complex-vertical":i=new MPHB.ComplexVerticalCtrl(t(this));break;case"dynamic-select":i=new MPHB.DynamicSelectCtrl(t(this))}t(this).attr("data-inited",!0)})}}),MPHB.WPGallery=can.Construct.extend({myThis:null,getInstance:function(){return null===MPHB.WPGallery.myThis&&(MPHB.WPGallery.myThis=new MPHB.WPGallery),MPHB.WPGallery.myThis}},{frame:null,ctrl:null,init:function(){MPHB.WPGallery.myThis=this,Attachment=wp.media.model.Attachment,wp.media.controller.MPHBGallery=wp.media.controller.FeaturedImage.extend({defaults:parent._.defaults({id:"mphb-media-library-gallery",title:MPHB.Plugin.myThis.data.translations.roomTypeGalleryTitle,toolbar:"main-insert",filterable:"uploaded",library:wp.media.query({type:"image"}),multiple:"add",editable:!0,priority:60,syncSelection:!1},wp.media.controller.Library.prototype.defaults),updateSelection:function(){var t,e=this.get("selection"),i=MPHB.WPGallery.myThis.ctrl.get();""!==i&&-1!==i&&(t=parent._.map(i.split(/,/),function(t){return Attachment.get(t)})),e.reset(t)}}),wp.media.view.MediaFrame.MPHBGallery=wp.media.view.MediaFrame.Post.extend({createStates:function(){this.options;this.states.add([new wp.media.controller.MPHBGallery])},bindHandlers:function(){wp.media.view.MediaFrame.Select.prototype.bindHandlers.apply(this,arguments),this.on("toolbar:create:main-insert",this.createToolbar,this);var t={content:{embed:"embedContent","edit-selection":"editSelectionContent"},toolbar:{"main-insert":"mainInsertToolbar"}};parent._.each(t,function(t,e){parent._.each(t,function(t,i){this.on(e+":render:"+i,this[t],this)},this)},this)},mainInsertToolbar:function(t){var e=this;this.selectionStatusToolbar(t),t.set("insert",{style:"primary",priority:80,text:MPHB.Plugin.myThis.data.translations.addGalleryToRoomType,requires:{selection:!0},click:function(){var t=e.state(),i=t.get("selection");e.close(),t.trigger("insert",i).reset()}})}}),this.frame=new wp.media.view.MediaFrame.MPHBGallery(parent._.defaults({},{state:"mphb-media-library-gallery",library:{type:"image"},multiple:!0})),this.frame.on("open",this.proxy("onOpen")),this.frame.on("insert",this.proxy("setImage"))},open:function(t){this.ctrl=t,this.frame.open()},onOpen:function(){var t=this.frame;t.reset();var e=this.ctrl.getArray();if(e.length){var i=null;e.forEach(function(e){i=wp.media.attachment(e),i.fetch(),t.state().get("selection").add(i)})}},setImage:function(){var e=[],i=this.frame.state().get("selection").models;t.each(i,function(t,i){var r=i.attributes;e.push(r.id)}),this.ctrl.set(e.join(","))}}),MPHB.Ctrl=can.Control.extend({},{parentForm:null,init:function(t,e){this.parentForm=this.element.closest("form")}}),MPHB.ColorPickerCtrl=MPHB.Ctrl.extend({},{input:null,init:function(t,e){this._super(t,e),this.input=this.element.find("input"),this.input.spectrum({allowEmpty:!0,preferredFormat:"hex",showInput:!0,showInitial:!0,showAlpha:!1})}}),MPHB.ComplexCtrl=MPHB.Ctrl.extend({},{prototypeItem:null,itemsHolder:null,lastIndex:null,uniqid:null,itemSelector:"tr",metaName:null,init:function(t,e){this._super(t,e),this.uniqid=this.element.children("table").attr("data-uniqid"),this.metaName=this.element.children('input[type="hidden"]:first-of-type').attr("name"),this.initItemsHolder(),this.initAddBtn(),this.initDeleteBtns(),this.preparePrototypeItem(),this.initLastIndex(),this.setKeys(this.itemsHolder.children(this.itemSelector))},makeItemsHolderSortable:function(){this.itemsHolder.sortable()},initLastIndex:function(){this.lastIndex=this.itemsHolder.children(this.itemSelector).length-1},initItemsHolder:function(){this.itemsHolder=this.element.children("table").children("tbody"),this.itemsHolder.hasClass("mphb-sortable")&&this.makeItemsHolderSortable()},initAddBtn:function(){var t=this;this.element.on("click",'.mphb-complex-add-item[data-id="'+this.uniqid+'"]',function(e){t.addItem()})},initDeleteBtns:function(){var e=this;this.itemsHolder.on("click",'.mphb-complex-delete-item[data-id="'+this.uniqid+'"]',function(i){e.deleteItem(t(this).closest(e.itemSelector))})},preparePrototypeItem:function(){var e=this.itemsHolder.children(".mphb-complex-item-prototype");this.prototypeItem=e.clone(),this.prototypeItem.removeClass("mphb-hide mphb-complex-item-prototype").find("[name]").each(function(){t(this).removeAttr("disabled")}),e.remove()},getIncIndex:function(){return++this.lastIndex},setKeys:function(e){var i,r,n,a,s,l=this,o=new RegExp("%key_"+this.uniqid+"%","g"),h="%key_"+this.uniqid+"%";e.each(function(e,d){s=t(d),a=s.attr("data-id"),a===h&&(a=l.getIncIndex(),s.attr("data-id",a)),s.find('[name*="[%key_'+l.uniqid+'%]"]').each(function(){i=t(this).attr("name").replace(o,a),t(this).attr("name",i),t(this).attr("id")&&(r=t(this).attr("id").replace(o,a).replace(/\[|\]/g,"__"),t(this).attr("name",i).attr("id",r))}),s.find('[for*="[%key_'+l.uniqid+'%]"]').each(function(){n=t(this).attr("for").replace(o,a).replace(/\[|\]/g,"__"),t(this).attr("for",n)})})},clonePrototypeItem:function(){var t=this.prototypeItem.clone();return this.setKeys(t),t},addItemToHolder:function(t){this.itemsHolder.append(t)},deleteItem:function(t){t.remove()},addItem:function(){var t=this.clonePrototypeItem();this.addItemToHolder(t);var e=t.find(".mphb-ctrl:not([data-inited])");MPHB.Plugin.myThis.setControls(e)}}),MPHB.ComplexVerticalCtrl=MPHB.ComplexCtrl.extend({},{itemSelector:"tbody",lastIndexInput:null,minItemsCount:0,init:function(t,e){this._super(t,e),this.minItemsCount=this.itemsHolder.attr("data-min-items-count")},initLastIndex:function(){this.lastIndexInput=this.itemsHolder.find(">tfoot .mphb-complex-last-index"),this.lastIndex=this.lastIndexInput.val()},getIncIndex:function(){var t=this._super();return this.lastIndexInput.val(t),t},initItemsHolder:function(){this.itemsHolder=this.element.children("table")},addItemToHolder:function(t){this.itemsHolder.children("tfoot").before(t)},disableDeleteButtons:function(){var t=this.itemsHolder.children(this.itemSelector).children(".mphb-complex-item-actions-holder").find(".mphb-complex-delete-item");t.attr("disabled","disabled").addClass("mphb-hide")},enableDeleteButtons:function(){var t=this.itemsHolder.children(this.itemSelector).children(".mphb-complex-item-actions-holder").find(".mphb-complex-delete-item");t.removeAttr("disabled").removeClass("mphb-hide")},updateItemActions:function(){var t=this.itemsHolder.children(this.itemSelector).length;t<=this.minItemsCount?this.disableDeleteButtons():this.enableDeleteButtons()},updateDefaultItem:function(){var t=this.itemsHolder.children(this.itemSelector).find('>.mphb-complex-item-actions-holder [name="'+this.metaName+'[default]"]');t.filter(":checked").length||t.first().attr("checked","checked")},deleteItem:function(t){this._super(t),this.updateItemActions(),this.updateDefaultItem()},addItem:function(){this._super(),this.updateItemActions(),this.updateDefaultItem()}}),MPHB.DatePickerCtrl=MPHB.Ctrl.extend({},{input:null,hiddenInput:null,init:function(t,e){this._super(t,e),this.input=this.element.find('input[type="text"]'),this.hiddenInput=this.element.find('input[type="hidden"]'),this.fixDate();var i=this.input.is("[data-multiple]");this.input.datepick({dateFormat:MPHB.Plugin.myThis.data.settings.dateFormat,altField:this.hiddenInput,altFormat:MPHB.Plugin.myThis.data.settings.dateTransferFormat,showSpeed:0,showOtherMonths:!1,multiSelect:i?999:0,monthsToShow:3,multiSeparator:","})},fixDate:function(){if(this.hiddenInput.val()){var e=t.datepick.parseDate(MPHB.Plugin.myThis.data.settings.dateTransferFormat,this.hiddenInput.val()),i=t.datepick.formatDate(MPHB.Plugin.myThis.data.settings.dateFormat,e);this.input.val(i)}else;}}),MPHB.DynamicSelectCtrl=MPHB.Ctrl.extend({},{dependencyCtrl:null,ajaxAction:null,ajaxNonce:null,errorsWrapper:null,preloader:null,defaultOption:null,init:function(t,e){this._super(t,e),this.input=this.element.find("select"),this.defaultOption=this.input.find('option[value=""]').clone(),this.errorsWrapper=this.element.find(".mphb-errors-wrapper"),this.preloader=this.element.find(".mphb-preloader"),this.ajaxAction=this.input.attr("data-ajax-action"),this.ajaxNonce=this.input.attr("data-ajax-nonce"),this.initDependencyCtrl()},initDependencyCtrl:function(){var t=this.input.attr("data-dependency");this.dependencyCtrl=this.element.closest("form").find('[name="'+t+'"]');var e=this;this.dependencyCtrl.on("change",function(t){e.updateList()}).on("focus",function(t){e.hideErrors()})},setOptions:function(e){var i=this;this.input.html(this.defaultOption.clone()),t.each(e,function(e,r){i.input.append(t("<option />",{value:e,html:r}))})},updateList:function(){var e=this;this.hideErrors(),this.showPreloader(),this.input.html(this.defaultOption.clone());var i=this.parseFormToJSON();t.ajax({url:MPHB.Plugin.myThis.data.ajaxUrl,type:"GET",dataType:"json",data:{action:e.ajaxAction,mphb_nonce:e.ajaxNonce,formValues:i},success:function(t){t.hasOwnProperty("success")?t.success?e.setOptions(t.data.options):e.showError(t.data.message):e.showError(MPHB.Plugin.myThis.data.translations.errorHasOccured)},error:function(t){e.showError(MPHB.Plugin.myThis.data.translations.errorHasOccured)},complete:function(t){e.hidePreloader()}})},parseFormToJSON:function(){return this.parentForm.serializeJSON()},showPreloader:function(){this.preloader.removeClass("mphb-hide")},hidePreloader:function(){this.preloader.addClass("mphb-hide")},hideErrors:function(){this.errorsWrapper.empty().addClass("mphb-hide")},showError:function(t){this.errorsWrapper.html(t).removeClass("mphb-hide")}}),MPHB.GalleryCtrl=MPHB.Ctrl.extend({},{input:null,previewHolder:null,addGalleryBtn:null,removeGalleryBtn:null,init:function(t,e){this._super(t,e),this.input=this.element.find("input[type=hidden]"),this.previewHolder=this.element.find("img").on("click",this.proxy("organizeGallery")),this.addGalleryBtn=this.element.find(".mphb-admin-organize-gallery-add").on("click",this.proxy("organizeGallery")),this.removeGalleryBtn=this.element.find(".mphb-admin-organize-gallery-remove").on("click",this.proxy("removeGallery"))},get:function(){return this.input.val()},getArray:function(){var t=this.get();return""!==t?this.get().split(/,/):[]},set:function(t){this.input.val(t),this.updatePreview(),this.updateBtnsVisibility()},updateBtnsVisibility:function(){var t=this.get();""!==t?(this.removeGalleryBtn.removeClass("mphb-hide"),this.addGalleryBtn.addClass("mphb-hide")):(this.removeGalleryBtn.addClass("mphb-hide"),this.addGalleryBtn.removeClass("mphb-hide"))},updatePreview:function(){var t=this.get();if(""!==t){var e=t.split(",").shift(),i=wp.media.attachment(e),r=i.attributes.sizes.medium.url;this.previewHolder.removeClass("mphb-hide").attr("src",r)}else this.previewHolder.addClass("mphb-hide").attr("src","")},organizeGallery:function(t){t.preventDefault(),MPHB.WPGallery.getInstance().open(this)},removeGallery:function(t){t.preventDefault(),this.set("")}}),MPHB.TotalPriceCtrl=MPHB.Ctrl.extend({},{preloader:null,input:null,init:function(t,e){this._super(t,e),this.input=this.element.find("input"),this.recalculateBtn=this.element.find("#mphb-recalculate-total-price"),this.errorsWrapper=this.element.find(".mphb-errors-wrapper"),this.preloader=this.element.find(".mphb-preloader")},set:function(t){this.input.val(t)},hideErrors:function(){this.errorsWrapper.empty().addClass("mphb-hide")},"input focus":function(){this.hideErrors()},showError:function(t){this.errorsWrapper.html(t).removeClass("mphb-hide")},"#mphb-recalculate-total-price click":function(e,i){var r=this;this.hideErrors(),this.showPreloader();var n=this.parseFormToJSON();t.ajax({url:MPHB.Plugin.myThis.data.ajaxUrl,type:"GET",dataType:"json",data:{action:"mphb_recalculate_total",mphb_nonce:MPHB.Plugin.myThis.data.nonces.mphb_recalculate_total,formValues:n},success:function(t){t.hasOwnProperty("success")?t.success?r.set(t.data.total):r.showError(t.data.message):r.showError(MPHB.Plugin.myThis.data.translations.errorHasOccured)},error:function(t){r.showError(MPHB.Plugin.myThis.data.translations.errorHasOccured)},complete:function(t){r.hidePreloader()}})},showPreloader:function(){this.recalculateBtn.attr("disabled","disabled"),this.preloader.removeClass("mphb-hide")},hidePreloader:function(){this.recalculateBtn.removeAttr("disabled"),this.preloader.addClass("mphb-hide")},parseFormToJSON:function(){return this.parentForm.serializeJSON()}}),new MPHB.Plugin,t(function(){t(".mphb-bookings-calendar-wrapper")&&new MPHB.BookingsCalendar(t(".mphb-bookings-calendar-wrapper"))})})}(jQuery);