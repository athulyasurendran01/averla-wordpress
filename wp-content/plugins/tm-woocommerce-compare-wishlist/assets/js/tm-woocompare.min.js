!function(a){"use strict";a(document).ready(function(){function e(){a(document).on("click",d,function(e){var g=a(this);e.preventDefault();var h=tmWoocompare.ajaxurl,i={action:"tm_woocompare_add_to_list",pid:g.data("id"),nonce:g.data("nonce"),single:g.hasClass("tm-woocompare-button-single")};g.removeClass(c).addClass(b),a.post(h,i,function(e){if(g.removeClass(b),e.success){switch(e.data.action){case"add":a(d+"[data-id="+i.pid+"]").addClass(c).find(".text").text(tmWoocompare.removeText),e.data.comparePageBtn&&g.after(e.data.comparePageBtn);break;case"remove":a(d+"[data-id="+i.pid+"]").removeClass(c).find(".text").text(tmWoocompare.compareText),a(".tm-woocompare-page-button").remove()}i={action:"tm_woocompare_update"},f(null,i)}void 0!==e.data.counts&&a(document).trigger("tm_compare_update_fragments",{response:e.data.counts})})})}function f(e,f){e&&e.preventDefault();var g=tmWoocompare.ajaxurl,h=a("div.tm-woocompare-widget-wrapper"),j=a("div.tm-woocompare-list");f.isComparePage=!!j.length,f.isWidget=!!h.length,("tm_woocompare_update"!==f.action||f.isComparePage||f.isWidget)&&(j.addClass(b),h.addClass(b),a.post(g,f,function(e){j.removeClass(b),h.removeClass(b),e.success&&(f.isComparePage&&(a("div.tm-woocompare-wrapper").html(e.data.compareList),a(document).trigger("enhance.tablesaw")),f.isWidget&&h.html(e.data.widget),"tm_woocompare_empty"===f.action&&(a(d).removeClass(c).find(".text").text(tmWoocompare.compareText),a(".tm-woocompare-page-button").remove()),"tm_woocompare_remove"===f.action&&(a(d+"[data-id="+f.pid+"]").removeClass(c).find(".text").text(tmWoocompare.compareText),a(".tm-woocompare-page-button").remove())),void 0!==e.data.counts&&a(document).trigger("tm_compare_update_fragments",{response:e.data.counts}),i()}))}function g(b){var c=a(b.currentTarget),d={action:"tm_woocompare_remove",pid:c.data("id"),nonce:c.data("nonce")};f(b,d)}function h(a){var b={action:"tm_woocompare_empty"};f(a,b)}function i(){a(".tm-woocompare-remove").off("click").on("click",function(a){g(a)}),a(".tm-woocompare-empty").off("click").on("click",function(a){h(a)})}function j(){a.ajax({url:tmWoocompare.ajaxurl,type:"get",dataType:"json",data:{action:"tm_compare_get_fragments"}}).done(function(b){a(document).trigger("tm_compare_update_fragments",{response:b.data})})}function k(b,c){a.isEmptyObject(c.response.defaultFragments)||a.each(c.response.defaultFragments,function(b,c){var d=a(b),e=a(".compare-count",d);0===e.length?d.append(tmWoocompare.countFormat.replace("%count%",c)):d.find(".compare-count").html(c)}),a.isEmptyObject(c.response.customFragments)||a.each(c.response.customFragments,function(b,c){var d=a(b);d.length&&d.html(c)})}var b="loading",c="added in_compare",d="button.tm-woocompare-button";a(document).on("tm_compare_update_fragments",k),i(),e(),j(),a(document).on("tm_wc_products_changed",function(){i(),e()})})}(jQuery);